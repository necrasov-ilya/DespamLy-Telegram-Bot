# ───────────────────────────────────────────────────────────────────
#  🤖 Telegram Bot Settings (ОБЯЗАТЕЛЬНО)
# ───────────────────────────────────────────────────────────────────

# Токен бота от @BotFather
# Получить: https://t.me/BotFather -> /newbot
BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz123456789


# ───────────────────────────────────────────────────────────────────
#  💾 Database Settings (ОБЯЗАТЕЛЬНО)
# ───────────────────────────────────────────────────────────────────

# PostgreSQL connection URL
# Формат: postgresql://username:password@host:port/database
# Для Docker: postgresql://postgres:postgres@localhost:5432/despamly
# Для Heroku: автоматически устанавливается через DATABASE_URL
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/despamly


# ───────────────────────────────────────────────────────────────────
#  🎚️ Default Thresholds (ОПЦИОНАЛЬНО)
# ───────────────────────────────────────────────────────────────────
# Эти значения используются как дефолты при создании нового ChatConfig
# Каждый чат может иметь свои пороги (настраиваются через /mychats)
# ───────────────────────────────────────────────────────────────────

# Порог уведомления (0.0-1.0)
# Если confidence >= META_NOTIFY, владелец получает уведомление
# Рекомендуется: 0.60-0.70 для баланса между спамом и ложными срабатываниями
META_NOTIFY=0.65

# Порог удаления (0.0-1.0)
# Если confidence >= META_DELETE, сообщение удаляется
# Рекомендуется: 0.80-0.90 для высокой уверенности
META_DELETE=0.85

# Порог бана (0.0-1.0)
# Если confidence >= META_KICK, пользователь банится (режим delete_and_ban)
# Рекомендуется: 0.90-0.95 для максимальной уверенности
META_KICK=0.95


# ───────────────────────────────────────────────────────────────────
#  🔧 Policy & Behavior (ОПЦИОНАЛЬНО)
# ───────────────────────────────────────────────────────────────────

# Режим работы по умолчанию для новых чатов
# Варианты:
#   - notify_only: только уведомления, без автоматических действий
#   - delete_only: автоматическое удаление спама (дефолт)
#   - delete_and_ban: удаление + softban пользователя
POLICY_MODE=delete_only

# Downweight множители (0.0-1.0) - снижают confidence для определённых случаев
# Чем меньше значение, тем сильнее снижение

# Для сообщений от админов чата
META_DOWNWEIGHT_ADMIN=0.90

# Для ответов на сообщения от администрации
META_DOWNWEIGHT_REPLY_TO_STAFF=0.90

# Для сообщений с whitelist-словами (бренды, названия компаний)
META_DOWNWEIGHT_WHITELIST=0.85

# Для сообщений с узнаваемыми брендами
META_DOWNWEIGHT_BRAND=0.70

# Для официальных объявлений канала
META_DOWNWEIGHT_ANNOUNCEMENT=0.85


# ───────────────────────────────────────────────────────────────────
#  📊 Logging & Debug (ОПЦИОНАЛЬНО)
# ───────────────────────────────────────────────────────────────────

# Уровень логирования
# Варианты: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO

# Детальная отладочная информация (true/false)
# Включает развёрнутую информацию о каждом анализе в логах
DETAILED_DEBUG_INFO=false


# ───────────────────────────────────────────────────────────────────
#  🔄 Training & Retraining (ОПЦИОНАЛЬНО)
# ───────────────────────────────────────────────────────────────────


RETRAIN_THRESHOLD=100

# ═══════════════════════════════════════════════════════════════════
#  📖 Примеры конфигураций
# ═══════════════════════════════════════════════════════════════════

# 🟢 Консервативный режим (минимум ложных срабатываний):
# META_NOTIFY=0.70
# META_DELETE=0.90
# META_KICK=0.95
# POLICY_MODE=delete_only

# 🟡 Сбалансированный режим (рекомендуется):
# META_NOTIFY=0.65
# META_DELETE=0.85
# META_KICK=0.93
# POLICY_MODE=delete_only

# 🔴 Агрессивный режим (максимальная защита):
# META_NOTIFY=0.60
# META_DELETE=0.80
# META_KICK=0.90
# POLICY_MODE=delete_and_ban

# 🔵 Тестовый режим (только наблюдение):
# META_NOTIFY=0.50
# META_DELETE=0.99
# META_KICK=0.99
# POLICY_MODE=notify_only


# ═══════════════════════════════════════════════════════════════════
#  🗂️ Структура данных и моделей
# ═══════════════════════════════════════════════════════════════════
#
# data/
#   ├── keywords.json           # Ключевые слова и regex паттерны
#   ├── messages.csv            # Обучающая выборка (message, label)
#   └── legit_examples.txt      # Примеры легитимных сообщений
#
# models/
#   ├── tfidf_vectorizer.pkl    # TF-IDF векторизатор (char n-grams 1-4)
#   ├── tfidf_classifier.pkl    # LogisticRegression + калибровка
#   ├── pattern_lgbm.pkl        # LightGBM (100 деревьев, 20 признаков)
#   └── pattern_calibrator.pkl  # Isotonic calibrator
#
# Обучение моделей:
#   python scripts/train_tfidf.py    # Обучить TF-IDF фильтр
#   python scripts/train_pattern.py  # Обучить Pattern Classifier
#
# ═══════════════════════════════════════════════════════════════════


# ═══════════════════════════════════════════════════════════════════
#  🚀 Быстрый старт
# ═══════════════════════════════════════════════════════════════════
#
# 1. Скопировать .env.example в .env
#    cp .env.example .env
#
# 2. Заполнить BOT_TOKEN (получить у @BotFather)
#
# 3. Настроить PostgreSQL:
#    docker run --name despamly-postgres -e POSTGRES_PASSWORD=postgres -p 5432:5432 -d postgres:14
#
# 4. Применить миграции:
#    python -c "from storage import init_storage; init_storage()"
#
# 5. Обучить модели (если нет готовых):
#    python scripts/train_tfidf.py
#    python scripts/train_pattern.py
#
# 6. Запустить бота:
#    python main.py
#
# 7. Добавить бота в групповой чат (он создаст ChatConfig автоматически)
#
# 8. Управлять чатами через /mychats в личных сообщениях
#
# ═══════════════════════════════════════════════════════════════════
